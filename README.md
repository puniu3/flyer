# Flyer Dungeon

Solo roguelike dice game with 5 six-sided dice. Available as browser game and printable version.

## Project Structure

```
flyer/
├── flyerdungeon.yaml      # SOURCE OF TRUTH: Game rules definition
├── src/                   # TypeScript source
│   ├── main.ts            # Entry point
│   ├── rules.ts           # Game logic (init, step, getView)
│   ├── renderer.ts        # DOM rendering
│   ├── types.ts           # Type definitions
│   ├── i18n.ts            # Internationalization
│   ├── guide.ts           # How-to-play guide
│   └── playSound.ts       # Sound effects
├── print/                 # Print version
│   └── flyerdungeon.html  # Self-contained A4 printable HTML
├── index.html             # Browser game entry HTML
├── main.js                # Transpiled bundle (generated by esbuild)
└── styles.css             # Browser version styles
```

## Source of Truth

**`flyerdungeon.yaml`** is the single source of truth for all game rules.

### YAML Structure

| Key | Description |
|-----|-------------|
| `dice_rules` | 5 dice, 6 sides each |
| `flow.turn_structure` | roll_phase → skill_phase → choose_category_phase |
| `categories.nodes` | 17 category nodes across 4 groups |
| `skills.list` | 3 skills with unlock conditions |
| `win_lose_conditions` | Victory/defeat triggers |

## Game Rules

### Win Condition
Check `dungeon_floor_5` category.

### Lose Condition
No valid category available on current turn.

### Turn Flow
1. **Roll Phase**: Roll dice (max 3 times per turn, selective reroll)
2. **Skill Phase**: Use unlocked skills (once per skill per turn)
3. **Category Phase**: Check exactly one satisfying category

### Category Groups

| Group | Categories | Unlock Skill |
|-------|------------|--------------|
| `dungeon` | floor_1 → floor_2 → floor_3 → floor_4 → floor_5 (sequential) | - |
| `str` | full_house, four_of_a_kind, three_of_a_kind_5, three_of_a_kind_6 | Mighty |
| `dex` | free, straight, three_of_a_kind_1, three_of_a_kind_2 | Acrobatics |
| `int` | one_pair, two_pair, three_of_a_kind_3, three_of_a_kind_4 | Metamorph |

### Skills (unlock by checking 3 categories in group)

| Skill | Effect |
|-------|--------|
| `skill_str_mighty` | Set one die to 6 |
| `skill_dex_acrobatics` | Decrease one die by 1 (min 1) |
| `skill_int_metamorph` | Invert die face (1↔6, 2↔5, 3↔4) |

## Architecture

### Browser Version (src/)
- **Pure functions**: `rules.ts` has no side effects
- **Unidirectional data flow**: GameState → GameView → Renderer
- **Event-driven**: PlayerAction → step() → new GameState

### Print Version (print/)
- **Self-contained**: No external dependencies
- **A4 format**: Ready for printing

## Commands

```bash
npm run build       # Transpile src/main.ts → main.js
npm run type-check  # Type check only
```

## Tech Stack

- TypeScript 5.3
- esbuild (bundler)
- Vanilla JS (no framework)
